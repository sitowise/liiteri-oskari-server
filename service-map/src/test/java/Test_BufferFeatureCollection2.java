
import static org.junit.Assert.assertEquals;

import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.nio.charset.StandardCharsets;
import java.util.*;

import com.vividsolutions.jts.geom.Geometry;
import com.vividsolutions.jts.geom.MultiPolygon;
import com.vividsolutions.jts.geom.Polygon;
import org.geotools.data.DataUtilities;
import org.geotools.data.simple.SimpleFeatureCollection;
import org.geotools.data.simple.SimpleFeatureIterator;
import org.geotools.feature.AttributeTypeBuilder;
import org.geotools.feature.simple.SimpleFeatureBuilder;
import org.geotools.feature.simple.SimpleFeatureTypeBuilder;
import org.geotools.feature.type.GeometryTypeImpl;
import org.junit.Test;
import org.opengis.feature.simple.SimpleFeature;
import org.opengis.feature.simple.SimpleFeatureType;
import org.opengis.feature.type.AttributeDescriptor;
import org.opengis.feature.type.GeometryDescriptor;
import org.xml.sax.SAXException;

import javax.xml.parsers.ParserConfigurationException;

public class Test_BufferFeatureCollection2 {
	
	private static final String xmlString25Features = "<?xml version=\"1.0\" encoding=\"UTF-8\"?><wfs:FeatureCollection xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:wfs=\"http://www.opengis.net/wfs\" xmlns:lipas=\"lipas\" xmlns:gml=\"http://www.opengis.net/gml\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" numberOfFeatures=\"25\" timeStamp=\"2018-11-02T13:41:01.535Z\" xsi:schemaLocation=\"lipas http://lipas.cc.jyu.fi:80/geoserver/lipas/wfs?service=WFS&amp;version=1.1.0&amp;request=DescribeFeatureType&amp;typeName=lipas%3Alipas_kaikki_pisteet http://www.opengis.net/wfs http://lipas.cc.jyu.fi:80/geoserver/schemas/wfs/1.1.0/wfs.xsd\"><gml:featureMembers><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a82\"><lipas:id>74119</lipas:id><lipas:tyyppikoodi>204</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Luontotorni</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Naturtorn</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Nature observation tower</lipas:tyyppi_nimi_en><lipas:nimi_fi>Höglandin luontotorni</lipas:nimi_fi><lipas:nimi_se>Höglandin luontotorni</lipas:nimi_se><lipas:sijainti_id>19359</lipas:sijainti_id><lipas:www/><lipas:sahkoposti/><lipas:puhelinnumero/><lipas:omistaja>Ei tietoa</lipas:omistaja><lipas:yllapitaja>Valtio</lipas:yllapitaja><lipas:katuosoite/><lipas:postinumero>25870</lipas:postinumero><lipas:postitoimipaikka/><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:lisatieto_fi/><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>239611.56478588 6672427.57282266</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"type\":\"Point\",\"coordinates\":[239611.5647858787,6672427.5728226602]}</lipas:piste_json><lipas:x>239611.5647858787</lipas:x><lipas:y>6672427.57282266</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a81\"><lipas:id>507764</lipas:id><lipas:tyyppikoodi>2120</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Kuntosali</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Gym</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Gym</lipas:tyyppi_nimi_en><lipas:nimi_fi>Ruukkihallin kuntosali</lipas:nimi_fi><lipas:nimi_se/><lipas:sijainti_id>501979</lipas:sijainti_id><lipas:www>http://www.kemionsaari.fi/fi/vapaaaika-ja-kulttuuri/liikunta/liikuntapaikat/liikuntahalli/</lipas:www><lipas:puhelinnumero>040 7726 828</lipas:puhelinnumero><lipas:muokattu_viimeksi>2015-10-19T10:08:42.236Z</lipas:muokattu_viimeksi><lipas:omistaja>Kunta</lipas:omistaja><lipas:yllapitaja>Kunta / muu</lipas:yllapitaja><lipas:katuosoite>Einarintie 1 A</lipas:katuosoite><lipas:postinumero>25900</lipas:postinumero><lipas:postitoimipaikka>Taalintehdas</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:lisatieto_fi>Matrix-kuntoilulaitteet.</lipas:lisatieto_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>249198.9427706 6662400.3015674</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"type\":\"Point\",\"coordinates\":[249198.9427706,6662400.3015674]}</lipas:piste_json><lipas:x>249198.9427706</lipas:x><lipas:y>6662400.3015674</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a80\"><lipas:id>518304</lipas:id><lipas:tyyppikoodi>2210</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Liikuntahalli</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Idrottshall</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Sports hall </lipas:tyyppi_nimi_en><lipas:nimi_fi>Ruukkihalli</lipas:nimi_fi><lipas:sijainti_id>511738</lipas:sijainti_id><lipas:www>http://www.kemionsaari.fi/fi/vapaaaika-ja-kulttuuri/liikunta/liikuntapaikat/liikuntahalli/</lipas:www><lipas:puhelinnumero>040 7726 828</lipas:puhelinnumero><lipas:muokattu_viimeksi>2015-11-17T12:55:19.585Z</lipas:muokattu_viimeksi><lipas:omistaja>Kunta</lipas:omistaja><lipas:yllapitaja>Kunta / muu</lipas:yllapitaja><lipas:katuosoite>Einarintie 1 A</lipas:katuosoite><lipas:postinumero>25900</lipas:postinumero><lipas:postitoimipaikka>Taalintehdas</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:lisatieto_fi>Sali voidaan jakaa kolmeen osaan väliseinillä.</lipas:lisatieto_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>249201.9427706 6662445.8015674</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"type\":\"Point\",\"coordinates\":[249201.9427706,6662445.8015674]}</lipas:piste_json><lipas:x>249201.9427706</lipas:x><lipas:y>6662445.8015674</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a7f\"><lipas:id>518308</lipas:id><lipas:tyyppikoodi>1340</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Pallokenttä</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Bollplan</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Ball field</lipas:tyyppi_nimi_en><lipas:nimi_fi>Taalintehtaan hiekkakenttä</lipas:nimi_fi><lipas:sijainti_id>511741</lipas:sijainti_id><lipas:www>http://www.kemionsaari.fi/fi/vapaaaika-ja-kulttuuri/liikunta/liikuntapaikat/taalintehtaan-urheilukentta/</lipas:www><lipas:puhelinnumero>02-4260210</lipas:puhelinnumero><lipas:muokattu_viimeksi>2015-10-19T10:12:27.284Z</lipas:muokattu_viimeksi><lipas:omistaja>Kunta</lipas:omistaja><lipas:yllapitaja>Kunta / liikuntatoimi</lipas:yllapitaja><lipas:katuosoite>Olavi Hjellmanin tie</lipas:katuosoite><lipas:postinumero>25900</lipas:postinumero><lipas:postitoimipaikka>Taalintehdas</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>249356.10352373 6662893.5325814</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"type\":\"Point\",\"coordinates\":[249356.10352373,6662893.5325814]}</lipas:piste_json><lipas:x>249356.10352373</lipas:x><lipas:y>6662893.5325814</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a7e\"><lipas:id>509065</lipas:id><lipas:tyyppikoodi>1210</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Yleisurheilun harjoitusalue</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Träningsområde för friidrott</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Athletics training area</lipas:tyyppi_nimi_en><lipas:nimi_fi>Taalintehtaan urheilukenttä</lipas:nimi_fi><lipas:nimi_se/><lipas:sijainti_id>502912</lipas:sijainti_id><lipas:www>http://www.kemionsaari.fi/fi/vapaaaika-ja-kulttuuri/liikunta/liikuntapaikat/taalintehtaan-urheilukentta/</lipas:www><lipas:sahkoposti/><lipas:puhelinnumero>02-4260 210</lipas:puhelinnumero><lipas:muokattu_viimeksi>2015-10-19T10:13:39.258Z</lipas:muokattu_viimeksi><lipas:omistaja>Kunta</lipas:omistaja><lipas:yllapitaja>Kunta / liikuntatoimi</lipas:yllapitaja><lipas:katuosoite>Olavi Hjellmanin tie</lipas:katuosoite><lipas:postinumero>25900</lipas:postinumero><lipas:postitoimipaikka>Taalintehdas</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>249294.10352373 6662718.5325814</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"type\":\"Point\",\"coordinates\":[249294.10352373,6662718.5325814]}</lipas:piste_json><lipas:x>249294.10352373</lipas:x><lipas:y>6662718.5325814</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a7d\"><lipas:id>505607</lipas:id><lipas:tyyppikoodi>6110</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Ratsastuskenttä</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Ridbana</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Equestrian field</lipas:tyyppi_nimi_en><lipas:nimi_fi>Rohan Tallien ratsastuskenttä</lipas:nimi_fi><lipas:nimi_se/><lipas:sijainti_id>500590</lipas:sijainti_id><lipas:www>www.rohan.fi</lipas:www><lipas:sahkoposti>ritarit@rohan.fi</lipas:sahkoposti><lipas:puhelinnumero>041-4422450</lipas:puhelinnumero><lipas:muokattu_viimeksi>2017-10-26T09:30:35.877Z</lipas:muokattu_viimeksi><lipas:omistaja>Yritys</lipas:omistaja><lipas:yllapitaja>Yksityinen / yritys</lipas:yllapitaja><lipas:katuosoite>Västanfjärdintie 911</lipas:katuosoite><lipas:postinumero>25830</lipas:postinumero><lipas:postitoimipaikka>Västanfjärd</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:lisatieto_fi/><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>258166 6665533</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"type\":\"Point\",\"coordinates\":[258166.0,6665533.0]}</lipas:piste_json><lipas:x>258166.0</lipas:x><lipas:y>6665533.0</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a7c\"><lipas:id>508124</lipas:id><lipas:tyyppikoodi>1620</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Golfkenttä</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Golfbana</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Golf course</lipas:tyyppi_nimi_en><lipas:nimi_fi>Bjärkas Golf</lipas:nimi_fi><lipas:nimi_se>Bjärkas Golf</lipas:nimi_se><lipas:sijainti_id>502230</lipas:sijainti_id><lipas:www>http://www.bjarkasgolf.com/</lipas:www><lipas:sahkoposti>bjarkas@bjarkas.com</lipas:sahkoposti><lipas:puhelinnumero>0440 184653</lipas:puhelinnumero><lipas:muokattu_viimeksi>2018-04-19T15:24:37.577Z</lipas:muokattu_viimeksi><lipas:omistaja>Yritys</lipas:omistaja><lipas:yllapitaja>Yksityinen / yritys</lipas:yllapitaja><lipas:katuosoite>Västanfjärdintie 655</lipas:katuosoite><lipas:postinumero>25840</lipas:postinumero><lipas:postitoimipaikka>Nivelax</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>257381.85352373 6667623.7825814</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"type\":\"Point\",\"coordinates\":[257381.85352373,6667623.7825814]}</lipas:piste_json><lipas:x>257381.85352373</lipas:x><lipas:y>6667623.7825814</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a7b\"><lipas:id>508130</lipas:id><lipas:tyyppikoodi>1120</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Lähiliikuntapaikka</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Näridrottsplats</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Neighbourhood sports area</lipas:tyyppi_nimi_en><lipas:nimi_fi>Västanfjärdin koulun lähiliikuntapaikka</lipas:nimi_fi><lipas:nimi_se>Västanfjärd skolas närmotionsplats</lipas:nimi_se><lipas:sijainti_id>502236</lipas:sijainti_id><lipas:www>http://www.kemionsaari.fi/fi/vapaaaika-ja-kulttuuri/liikunta/</lipas:www><lipas:sahkoposti/><lipas:puhelinnumero>02 4260 211</lipas:puhelinnumero><lipas:muokattu_viimeksi>2015-10-21T05:57:07.101Z</lipas:muokattu_viimeksi><lipas:omistaja>Kunta</lipas:omistaja><lipas:yllapitaja>Kunta / muu</lipas:yllapitaja><lipas:katuosoite>Bodängintie 11 c</lipas:katuosoite><lipas:postinumero>25840</lipas:postinumero><lipas:postitoimipaikka>Nivelax</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:lisatieto_fi>Miniareena, jossa juoksuradat ja pituushyppypaikka. </lipas:lisatieto_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>257110.85352373 6668135.7825814</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"coordinates\":[257110.85352373,6668135.7825814],\"type\":\"Point\"}</lipas:piste_json><lipas:x>257110.85352373</lipas:x><lipas:y>6668135.7825814</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a7a\"><lipas:id>524811</lipas:id><lipas:tyyppikoodi>1120</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Lähiliikuntapaikka</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Näridrottsplats</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Neighbourhood sports area</lipas:tyyppi_nimi_en><lipas:nimi_fi>Taalintehtaan monitoimikenttä</lipas:nimi_fi><lipas:sijainti_id>520052</lipas:sijainti_id><lipas:www>http://www.kemionsaari.fi/fi/vapaaaika-ja-kulttuuri/liikunta/liikuntapaikat/taalintehtaan-urheilukentta/</lipas:www><lipas:muokattu_viimeksi>2016-11-25T08:06:02.561Z</lipas:muokattu_viimeksi><lipas:omistaja>Kunta</lipas:omistaja><lipas:yllapitaja>Kunta / liikuntatoimi</lipas:yllapitaja><lipas:katuosoite>Olavi Hjellmanin tie 11</lipas:katuosoite><lipas:postinumero>25900</lipas:postinumero><lipas:postitoimipaikka>Taalintehdas</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:lisatieto_fi>Pelikenttä 12x21 m, 2 maalia, tolpat lentopalloverkolle, koripallokori.</lipas:lisatieto_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>249383.19009541 6662787.53813</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"type\":\"Point\",\"coordinates\":[249383.19009541,6662787.53813]}</lipas:piste_json><lipas:x>249383.19009541</lipas:x><lipas:y>6662787.53813</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a79\"><lipas:id>513796</lipas:id><lipas:tyyppikoodi>3230</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Uimapaikka</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Badplats</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Unsupervised beach </lipas:tyyppi_nimi_en><lipas:nimi_fi>Västerbuktenin uimaranta</lipas:nimi_fi><lipas:sijainti_id>506696</lipas:sijainti_id><lipas:www>http://www.kemionsaari.fi/fi/vapaaaika-ja-kulttuuri/Liikunta/uimarannat/</lipas:www><lipas:puhelinnumero>02 4260 211</lipas:puhelinnumero><lipas:muokattu_viimeksi>2018-07-20T09:01:34.087Z</lipas:muokattu_viimeksi><lipas:omistaja>Kunta</lipas:omistaja><lipas:yllapitaja>Kunta / muu</lipas:yllapitaja><lipas:katuosoite>Ölmosintie 469</lipas:katuosoite><lipas:postinumero>25870</lipas:postinumero><lipas:postitoimipaikka>Dragsfjärd</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:lisatieto_fi>Ranta on varustettu leikkpaikkavälineillä, ulkokäymälöillä, pukuhuoneilla sekä 25 metrin merkityllä kuntouintiradalla. Pyörätuolilla pääsee hiekalle asetettua kumimattoa pitkin veteen. </lipas:lisatieto_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>243659.65050344 6670650.085465</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"type\":\"Point\",\"coordinates\":[243659.65050344,6670650.085465]}</lipas:piste_json><lipas:x>243659.65050344</lipas:x><lipas:y>6670650.085465</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a78\"><lipas:id>513798</lipas:id><lipas:tyyppikoodi>3230</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Uimapaikka</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Badplats</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Unsupervised beach </lipas:tyyppi_nimi_en><lipas:nimi_fi>Sanduddenin ranta</lipas:nimi_fi><lipas:sijainti_id>506697</lipas:sijainti_id><lipas:www>http://www.kemionsaari.fi/fi/vapaaaika-ja-kulttuuri/Liikunta/uimarannat/</lipas:www><lipas:muokattu_viimeksi>2018-07-20T09:00:27.004Z</lipas:muokattu_viimeksi><lipas:omistaja>Säätiö</lipas:omistaja><lipas:yllapitaja>Yksityinen / säätiö</lipas:yllapitaja><lipas:katuosoite>Grophagintie</lipas:katuosoite><lipas:postinumero>25900</lipas:postinumero><lipas:postitoimipaikka>Taalintehdas</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:lisatieto_fi>Folkhälsanin ranta.</lipas:lisatieto_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>250714.48022098 6662421.9119155</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"type\":\"Point\",\"coordinates\":[250714.48022098,6662421.9119155]}</lipas:piste_json><lipas:x>250714.48022098</lipas:x><lipas:y>6662421.9119155</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a77\"><lipas:id>513809</lipas:id><lipas:tyyppikoodi>3230</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Uimapaikka</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Badplats</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Unsupervised beach </lipas:tyyppi_nimi_en><lipas:nimi_fi>Misskärrin uimapaikka</lipas:nimi_fi><lipas:sijainti_id>506706</lipas:sijainti_id><lipas:www>http://www.kemionsaari.fi/fi/vapaaaika-ja-kulttuuri/Liikunta/uimarannat/</lipas:www><lipas:muokattu_viimeksi>2018-07-20T08:59:25.555Z</lipas:muokattu_viimeksi><lipas:omistaja>Ei tietoa</lipas:omistaja><lipas:yllapitaja>Ei tietoa</lipas:yllapitaja><lipas:katuosoite>Fagernäsintie</lipas:katuosoite><lipas:postinumero>25900</lipas:postinumero><lipas:postitoimipaikka>Västanfjärd</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>255559.44481274 6664856.6862076</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"type\":\"Point\",\"coordinates\":[255559.44481274,6664856.6862076]}</lipas:piste_json><lipas:x>255559.44481274</lipas:x><lipas:y>6664856.6862076</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a76\"><lipas:id>513818</lipas:id><lipas:tyyppikoodi>3230</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Uimapaikka</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Badplats</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Unsupervised beach </lipas:tyyppi_nimi_en><lipas:nimi_fi>Björkbodan uimapaikka</lipas:nimi_fi><lipas:sijainti_id>506713</lipas:sijainti_id><lipas:www>http://www.kemionsaari.fi/fi/vapaaaika-ja-kulttuuri/Liikunta/uimarannat/</lipas:www><lipas:muokattu_viimeksi>2018-07-20T08:11:11.284Z</lipas:muokattu_viimeksi><lipas:omistaja>Ei tietoa</lipas:omistaja><lipas:yllapitaja>Ei tietoa</lipas:yllapitaja><lipas:katuosoite>Bodängintie</lipas:katuosoite><lipas:postinumero>25840</lipas:postinumero><lipas:postitoimipaikka>Nivelax</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>254191.14272402 6668625.3348214</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"type\":\"Point\",\"coordinates\":[254191.14272402,6668625.3348214]}</lipas:piste_json><lipas:x>254191.14272402</lipas:x><lipas:y>6668625.3348214</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a75\"><lipas:id>513824</lipas:id><lipas:tyyppikoodi>3230</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Uimapaikka</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Badplats</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Unsupervised beach </lipas:tyyppi_nimi_en><lipas:nimi_fi>Furulundin uimapaikka</lipas:nimi_fi><lipas:sijainti_id>506720</lipas:sijainti_id><lipas:www>http://www.kemionsaari.fi/fi/vapaaaika-ja-kulttuuri/Liikunta/uimarannat/</lipas:www><lipas:muokattu_viimeksi>2018-07-20T08:20:26.869Z</lipas:muokattu_viimeksi><lipas:omistaja>Ei tietoa</lipas:omistaja><lipas:yllapitaja>Ei tietoa</lipas:yllapitaja><lipas:katuosoite>Furulundintie</lipas:katuosoite><lipas:postinumero>25870</lipas:postinumero><lipas:postitoimipaikka>Dragsfjärd</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>248027.03371443 6667762.5498536</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"type\":\"Point\",\"coordinates\":[248027.03371443,6667762.5498536]}</lipas:piste_json><lipas:x>248027.03371443</lipas:x><lipas:y>6667762.5498536</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a74\"><lipas:id>518323</lipas:id><lipas:tyyppikoodi>2150</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Liikuntasali</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Idrottssal</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Gymnastics hall</lipas:tyyppi_nimi_en><lipas:nimi_fi>Vårdkasenin sali</lipas:nimi_fi><lipas:sijainti_id>511748</lipas:sijainti_id><lipas:puhelinnumero/><lipas:muokattu_viimeksi>2015-04-28T07:14:11.420Z</lipas:muokattu_viimeksi><lipas:omistaja>Rekisteröity yhdistys</lipas:omistaja><lipas:yllapitaja>Yksityinen / yhdistys</lipas:yllapitaja><lipas:katuosoite>Seuratalontie</lipas:katuosoite><lipas:postinumero>25830</lipas:postinumero><lipas:postitoimipaikka>Västanfjärd</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>258579.29702519 6665029.7093842</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"coordinates\":[258579.29702519,6665029.7093842],\"type\":\"Point\"}</lipas:piste_json><lipas:x>258579.29702519</lipas:x><lipas:y>6665029.7093842</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a73\"><lipas:id>518324</lipas:id><lipas:tyyppikoodi>1340</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Pallokenttä</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Bollplan</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Ball field</lipas:tyyppi_nimi_en><lipas:nimi_fi>Vårdkasenin jalkapallokenttä</lipas:nimi_fi><lipas:sijainti_id>511749</lipas:sijainti_id><lipas:muokattu_viimeksi>2015-10-21T06:05:14.093Z</lipas:muokattu_viimeksi><lipas:omistaja>Rekisteröity yhdistys</lipas:omistaja><lipas:yllapitaja>Yksityinen / yhdistys</lipas:yllapitaja><lipas:katuosoite>Seuratalontie</lipas:katuosoite><lipas:postinumero>25830</lipas:postinumero><lipas:postitoimipaikka>Västanfjärd</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>258552.79702519 6665086.7093842</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"coordinates\":[258552.79702519,6665086.7093842],\"type\":\"Point\"}</lipas:piste_json><lipas:x>258552.79702519</lipas:x><lipas:y>6665086.7093842</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a72\"><lipas:id>518327</lipas:id><lipas:tyyppikoodi>1220</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Yleisurheilukenttä</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Friidrottsplan</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Athletics field</lipas:tyyppi_nimi_en><lipas:nimi_fi>Dragsfjärdin urheilukenttä</lipas:nimi_fi><lipas:sijainti_id>511752</lipas:sijainti_id><lipas:www>http://www.kemionsaari.fi/fi/vapaaaika-ja-kulttuuri/liikunta/liikuntapaikat/muut-liikuntapaikat/</lipas:www><lipas:puhelinnumero>02-4260211</lipas:puhelinnumero><lipas:muokattu_viimeksi>2015-04-29T09:45:45.210Z</lipas:muokattu_viimeksi><lipas:omistaja>Kunta</lipas:omistaja><lipas:yllapitaja>Kunta / muu</lipas:yllapitaja><lipas:katuosoite>Urheilutie</lipas:katuosoite><lipas:postinumero>25870</lipas:postinumero><lipas:postitoimipaikka>Dragsfjärd</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>248474.29702519 6668131.2093842</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"coordinates\":[248474.29702519,6668131.2093842],\"type\":\"Point\"}</lipas:piste_json><lipas:x>248474.29702519</lipas:x><lipas:y>6668131.2093842</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a71\"><lipas:id>518316</lipas:id><lipas:tyyppikoodi>1340</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Pallokenttä</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Bollplan</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Ball field</lipas:tyyppi_nimi_en><lipas:nimi_fi>Björkbodan nurmikenttä</lipas:nimi_fi><lipas:nimi_se>Björkboda fotbollsplan</lipas:nimi_se><lipas:sijainti_id>511745</lipas:sijainti_id><lipas:www>http://www.kemionsaari.fi/fi/vapaaaika-ja-kulttuuri/liikunta/liikuntapaikat/muut-liikuntapaikat/</lipas:www><lipas:puhelinnumero>02-4260211</lipas:puhelinnumero><lipas:muokattu_viimeksi>2015-10-21T06:13:29.053Z</lipas:muokattu_viimeksi><lipas:omistaja>Kunta</lipas:omistaja><lipas:yllapitaja>Kunta / muu</lipas:yllapitaja><lipas:katuosoite>Smedskullantie 1</lipas:katuosoite><lipas:postinumero>25860</lipas:postinumero><lipas:postitoimipaikka>Björkboda</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>253057.23401473 6670604.2330229</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"coordinates\":[253057.23401473,6670604.2330229],\"type\":\"Point\"}</lipas:piste_json><lipas:x>253057.23401473</lipas:x><lipas:y>6670604.2330229</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a70\"><lipas:id>518360</lipas:id><lipas:tyyppikoodi>1530</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Kaukalo</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Rink</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Rink</lipas:tyyppi_nimi_en><lipas:nimi_fi>Nivelaxin kaukalo</lipas:nimi_fi><lipas:sijainti_id>511784</lipas:sijainti_id><lipas:www>http://www.kemionsaari.fi/fi/vapaaaika-ja-kulttuuri/liikunta/talviliikuntapaikat/</lipas:www><lipas:muokattu_viimeksi>2015-10-19T10:01:52.328Z</lipas:muokattu_viimeksi><lipas:omistaja>Kunta</lipas:omistaja><lipas:yllapitaja>Kunta / liikuntatoimi</lipas:yllapitaja><lipas:katuosoite>Västanfjärdintie</lipas:katuosoite><lipas:postinumero>25840</lipas:postinumero><lipas:postitoimipaikka>Nivelax</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>257276.35352373 6667676.7825814</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"type\":\"Point\",\"coordinates\":[257276.35352373,6667676.7825814]}</lipas:piste_json><lipas:x>257276.35352373</lipas:x><lipas:y>6667676.7825814</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a6f\"><lipas:id>518353</lipas:id><lipas:tyyppikoodi>1520</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Luistelukenttä</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Skridskobana</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Ice-skating field</lipas:tyyppi_nimi_en><lipas:nimi_fi>Taalintehtaan luistelukenttä</lipas:nimi_fi><lipas:sijainti_id>511741</lipas:sijainti_id><lipas:www>http://www.kemionsaari.fi/fi/vapaaaika-ja-kulttuuri/liikunta/liikuntapaikat/taalintehtaan-urheilukentta/</lipas:www><lipas:puhelinnumero>02-4260210</lipas:puhelinnumero><lipas:muokattu_viimeksi>2015-10-21T05:56:41.424Z</lipas:muokattu_viimeksi><lipas:omistaja>Kunta</lipas:omistaja><lipas:yllapitaja>Kunta / muu</lipas:yllapitaja><lipas:katuosoite>Olavi Hjellmanin tie</lipas:katuosoite><lipas:postinumero>25900</lipas:postinumero><lipas:postitoimipaikka>Taalintehdas</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>249356.10352373 6662893.5325814</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"type\":\"Point\",\"coordinates\":[249356.10352373,6662893.5325814]}</lipas:piste_json><lipas:x>249356.10352373</lipas:x><lipas:y>6662893.5325814</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a6e\"><lipas:id>509066</lipas:id><lipas:tyyppikoodi>1530</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Kaukalo</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Rink</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Rink</lipas:tyyppi_nimi_en><lipas:nimi_fi>Taalintehtaan kaukalo</lipas:nimi_fi><lipas:nimi_se/><lipas:sijainti_id>502913</lipas:sijainti_id><lipas:www>http://www.kemionsaari.fi/fi/vapaaaika-ja-kulttuuri/liikunta/liikuntapaikat/taalintehtaan-urheilukentta/</lipas:www><lipas:sahkoposti/><lipas:puhelinnumero>02-4260 210</lipas:puhelinnumero><lipas:muokattu_viimeksi>2015-10-19T10:13:02.904Z</lipas:muokattu_viimeksi><lipas:omistaja>Kunta</lipas:omistaja><lipas:yllapitaja>Kunta / liikuntatoimi</lipas:yllapitaja><lipas:katuosoite>Olavi Hjellmanin tie</lipas:katuosoite><lipas:postinumero>25900</lipas:postinumero><lipas:postitoimipaikka>Taalintehdas</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>249426.85352373 6662846.7825813</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"type\":\"Point\",\"coordinates\":[249426.85352373,6662846.7825813]}</lipas:piste_json><lipas:x>249426.85352373</lipas:x><lipas:y>6662846.7825813</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a6d\"><lipas:id>518357</lipas:id><lipas:tyyppikoodi>1520</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Luistelukenttä</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Skridskobana</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Ice-skating field</lipas:tyyppi_nimi_en><lipas:nimi_fi>Dragsfjärdin luistelukenttä</lipas:nimi_fi><lipas:sijainti_id>511752</lipas:sijainti_id><lipas:www>http://www.kemionsaari.fi/fi/vapaaaika-ja-kulttuuri/liikunta/talviliikuntapaikat/</lipas:www><lipas:puhelinnumero>02-4260211</lipas:puhelinnumero><lipas:muokattu_viimeksi>2015-10-21T05:53:27.007Z</lipas:muokattu_viimeksi><lipas:omistaja>Kunta</lipas:omistaja><lipas:yllapitaja>Ei tietoa</lipas:yllapitaja><lipas:katuosoite>Urheilutie</lipas:katuosoite><lipas:postinumero>25870</lipas:postinumero><lipas:postitoimipaikka>Dragsfjärd</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>248474.29702519 6668131.2093842</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"coordinates\":[248474.29702519,6668131.2093842],\"type\":\"Point\"}</lipas:piste_json><lipas:x>248474.29702519</lipas:x><lipas:y>6668131.2093842</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a6c\"><lipas:id>505593</lipas:id><lipas:tyyppikoodi>6110</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Ratsastuskenttä</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Ridbana</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Equestrian field</lipas:tyyppi_nimi_en><lipas:nimi_fi>Ratsastustalli Eskilsin kenttä</lipas:nimi_fi><lipas:nimi_se/><lipas:sijainti_id>500576</lipas:sijainti_id><lipas:www>www.ridstalleskils.fi</lipas:www><lipas:sahkoposti>ridstalleskil@gmail.com</lipas:sahkoposti><lipas:puhelinnumero>044-2577207</lipas:puhelinnumero><lipas:muokattu_viimeksi>2017-10-26T09:08:46.598Z</lipas:muokattu_viimeksi><lipas:omistaja>Yritys</lipas:omistaja><lipas:yllapitaja>Yksityinen / yritys</lipas:yllapitaja><lipas:katuosoite>Nygårdintie 9</lipas:katuosoite><lipas:postinumero>25870</lipas:postinumero><lipas:postitoimipaikka>Dragsfjärd</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:lisatieto_fi/><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>251596 6669963</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"type\":\"Point\",\"coordinates\":[251596.0,6669963.0]}</lipas:piste_json><lipas:x>251596.0</lipas:x><lipas:y>6669963.0</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a6b\"><lipas:id>519809</lipas:id><lipas:tyyppikoodi>5210</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Urheiluilmailualue</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Område för flygsport</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Sport aviation area</lipas:tyyppi_nimi_en><lipas:nimi_fi>Genbölen lentokenttä</lipas:nimi_fi><lipas:sijainti_id>513765</lipas:sijainti_id><lipas:www>http://www.saaristonilmailukerho.fi/</lipas:www><lipas:puhelinnumero>040 7614793</lipas:puhelinnumero><lipas:muokattu_viimeksi>2015-07-10T06:38:53.280Z</lipas:muokattu_viimeksi><lipas:omistaja>Ei tietoa</lipas:omistaja><lipas:yllapitaja>Yksityinen / yhdistys</lipas:yllapitaja><lipas:katuosoite>Yötaivaantie</lipas:katuosoite><lipas:postinumero>25870</lipas:postinumero><lipas:postitoimipaikka>Dragsfjärd</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:lisatieto_fi>Yksityinen kenttä, vain ultrakevyille lentokoneille. Ilmailukerholla konehalli ja kerhotila.</lipas:lisatieto_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>251012.92240559 6669552.4548238</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"type\":\"Point\",\"coordinates\":[251012.92240559,6669552.4548238]}</lipas:piste_json><lipas:x>251012.92240559</lipas:x><lipas:y>6669552.4548238</lipas:y></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d4a4a463_-1a6a\"><lipas:id>518325</lipas:id><lipas:tyyppikoodi>1370</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Tenniskenttäalue</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Område med tennisbanor</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Tennis court area</lipas:tyyppi_nimi_en><lipas:nimi_fi>Vårdkasenin tenniskentät</lipas:nimi_fi><lipas:nimi_se>Vårdkasens tennisplaner</lipas:nimi_se><lipas:sijainti_id>511750</lipas:sijainti_id><lipas:muokattu_viimeksi>2015-10-21T06:18:20.423Z</lipas:muokattu_viimeksi><lipas:omistaja>Rekisteröity yhdistys</lipas:omistaja><lipas:yllapitaja>Yksityinen / yhdistys</lipas:yllapitaja><lipas:katuosoite>Seuratalontie</lipas:katuosoite><lipas:postinumero>25830</lipas:postinumero><lipas:postitoimipaikka>Västanfjärd</lipas:postitoimipaikka><lipas:kuntanumero>322</lipas:kuntanumero><lipas:kunta_nimi_fi>Kemiönsaari</lipas:kunta_nimi_fi><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>258461.79702519 6665115.2093842</gml:pos></gml:Point></lipas:the_geom><lipas:piste_json>{\"coordinates\":[258461.79702519,6665115.2093842],\"type\":\"Point\"}</lipas:piste_json><lipas:x>258461.79702519</lipas:x><lipas:y>6665115.2093842</lipas:y></lipas:lipas_kaikki_pisteet></gml:featureMembers></wfs:FeatureCollection>";
	private static final String xmlString2Features = "<?xml version=\"1.0\" encoding=\"UTF-8\"?><wfs:FeatureCollection xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:wfs=\"http://www.opengis.net/wfs\" xmlns:lipas=\"lipas\" xmlns:gml=\"http://www.opengis.net/gml\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" numberOfFeatures=\"2\" timeStamp=\"2018-11-02T16:28:03.780Z\" xsi:schemaLocation=\"lipas http://lipas.cc.jyu.fi:80/geoserver/lipas/wfs?service=WFS&amp;version=1.1.0&amp;request=DescribeFeatureType&amp;typeName=lipas%3Alipas_kaikki_pisteet http://www.opengis.net/wfs http://lipas.cc.jyu.fi:80/geoserver/schemas/wfs/1.1.0/wfs.xsd\"><gml:featureMembers><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d5404cf3_-490f\"><lipas:id>519505</lipas:id><lipas:tyyppikoodi>6110</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Ratsastuskenttä</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Ridbana</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Equestrian field</lipas:tyyppi_nimi_en><lipas:nimi_fi>Ratsastuskoulu Kyläkorven kenttä</lipas:nimi_fi><lipas:sijainti_id>513155</lipas:sijainti_id><lipas:www>http://www.ratsastuskoulukylakorpi.fi/</lipas:www><lipas:sahkoposti>anna_kylakorpi@hotmail.com</lipas:sahkoposti><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>216119.77081333 6852749.8030721</gml:pos></gml:Point></lipas:the_geom></lipas:lipas_kaikki_pisteet><lipas:lipas_kaikki_pisteet gml:id=\"lipas_kaikki_pisteet.fid-4dd7c2e6_166d5404cf3_-490e\"><lipas:id>519504</lipas:id><lipas:tyyppikoodi>6120</lipas:tyyppikoodi><lipas:tyyppi_nimi_fi>Ratsastusmaneesi</lipas:tyyppi_nimi_fi><lipas:tyyppi_nimi_se>Ridmanege</lipas:tyyppi_nimi_se><lipas:tyyppi_nimi_en>Riding manège</lipas:tyyppi_nimi_en><lipas:nimi_fi>Ratsastuskoulu Kyläkorven maneesi</lipas:nimi_fi><lipas:sijainti_id>513154</lipas:sijainti_id><lipas:www>http://www.ratsastuskoulukylakorpi.fi/</lipas:www><lipas:sahkoposti>anna_kylakorpi@hotmail.com</lipas:sahkoposti><lipas:the_geom><gml:Point srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:pos>216127.27081333 6852827.8030721</gml:pos></gml:Point></lipas:the_geom></lipas:lipas_kaikki_pisteet></gml:featureMembers></wfs:FeatureCollection>";
	
	
	private static final String kryzStringFeatures = "<?xml version=\"1.0\" encoding=\"UTF-8\"?><wfs:FeatureCollection xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:wfs=\"http://www.opengis.net/wfs\" xmlns:lipas=\"lipas\" xmlns:gml=\"http://www.opengis.net/gml\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" numberOfFeatures=\"2\" timeStamp=\"2018-11-16T20:33:48.231Z\" xsi:schemaLocation=\"lipas http://lipas.cc.jyu.fi:80/geoserver/lipas/wfs?service=WFS&amp;version=1.1.0&amp;request=DescribeFeatureType&amp;typeName=lipas%3Alipas_kaikki_alueet http://www.opengis.net/wfs http://lipas.cc.jyu.fi:80/geoserver/schemas/wfs/1.1.0/wfs.xsd\"><gml:featureMembers><lipas:lipas_kaikki_alueet gml:id=\"lipas_kaikki_alueet.fid-4dd7c2e6_1671e36f53d_115b\"><lipas:id>72704</lipas:id><lipas:tyyppikoodi>104</lipas:tyyppikoodi><lipas:the_geom><gml:Polygon srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:exterior><gml:LinearRing><gml:posList>317043.48014361 6650005.75757794 317032.15492104 6650052.3123738 317042.22078106 6650073.70337875 317040.96364001 6650107.67627593 317043.47955612 6650120.25823916 317033.41358634 6650120.25818752 317023.34733252 6650175.62199282 316941.56068954 6650150.4556254 316931.49491343 6650112.70972276 316901.29773367 6649970.5249309 316887.45710508 6649905.0970804 316876.13236677 6649857.28315441 316867.32556588 6649827.08520011 316907.58946435 6649823.31041218 316962.95334751 6649818.27668784 316947.85360173 6649772.98077029 316932.75586438 6649735.23279464 316918.91508087 6649700.00080608 316876.13320625 6649693.70961136 316892.18723553 6649680.75106283 316921.43116485 6649679.86887959 316940.30405173 6649687.41896552 316950.37009899 6649672.32108621 316949.11317746 6649663.51207679 317020.83422515 6649615.698577 317063.61421402 6649590.53489591 317051.03194071 6649653.44663013 317086.26188235 6649639.6058467 317125.26891737 6649615.69911296 317165.53279642 6649615.69931959 317185.66448408 6649664.77230464 317193.21433759 6649691.19525792 317192.76181244 6649710.4858052 317186.92314928 6649732.7181183 317164.27308508 6649751.59092755 317161.75701403 6649769.20687339 317164.12953867 6649799.13866162 317157.9818193 6649808.21171889 317144.65242982 6649850.97103813 317115.31231806 6649845.06068735 317108.90860791 6649872.38227979 317121.49243762 6649905.09828124 317124.00831496 6649925.23023354 317120.20246556 6649953.91321207 317124.0080567 6649975.56008202 317122.75097376 6649998.20799559 317043.48014361 6650005.75757794 317043.48014361 6650005.75757794 317043.48014361 6650005.75757794 317043.48014361 6650005.75757794</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon></lipas:the_geom></lipas:lipas_kaikki_alueet><lipas:lipas_kaikki_alueet gml:id=\"lipas_kaikki_alueet.fid-4dd7c2e6_1671e36f53d_115c\"><lipas:id>519989</lipas:id><lipas:tyyppikoodi>104</lipas:tyyppikoodi><lipas:the_geom><gml:Polygon srsName=\"http://www.opengis.net/gml/srs/epsg.xml#3067\" srsDimension=\"2\"><gml:exterior><gml:LinearRing><gml:posList>317204.12550929 6650115.962917 317257.12550929 6650030.962917 317249.12550929 6649977.962917 317192.12550929 6649946.962917 317207.12550929 6649898.962917 317240.12550929 6649832.962917 317255.12550929 6649772.962917 317244.12550929 6649754.962917 317248.12550929 6649734.962917 317237.12550929 6649701.962917 317268.12550929 6649670.962917 317314.12550929 6649669.962917 317332.12550929 6649637.962917 317273.12550929 6649621.962917 317290.12550929 6649583.962917 317331.12550929 6649582.962917 317315.12550929 6649544.962917 317374.12550929 6649450.962917 317398.12550929 6649390.962917 317367.12550929 6649359.962917 317380.12550929 6649320.962917 317416.12550929 6649290.962917 317531.12550929 6649271.962917 317561.12550929 6649287.962917 317663.12550929 6649310.962917 317727.12550929 6649335.962917 317814.12550929 6649351.962917 317852.12550929 6649345.962917 317902.12550929 6649374.962917 317953.12550929 6649373.962917 317992.12550929 6649399.962917 318013.12550929 6649440.962917 317976.12550929 6649471.962917 317909.12550929 6649478.962917 317871.12550929 6649463.962917 317822.12550929 6649452.962917 317799.12550929 6649467.962917 317797.12550929 6649495.962917 317749.12550929 6649514.962917 317718.12550929 6649531.962917 317696.12550929 6649544.962917 317659.12550929 6649540.962917 317640.12550929 6649571.962917 317652.12550929 6649628.962917 317697.12550929 6649793.962917 317682.12550929 6649863.962917 317665.12550929 6649920.962917 317695.12550929 6649979.962917 317801.12550929 6650083.962917 317869.12550929 6650123.962917 317915.12550929 6650187.962917 317988.12550929 6650217.962917 318063.12550929 6650261.962917 318171.12550929 6650274.962917 318141.12550929 6650613.962917 318073.12550929 6650640.962917 318032.12550929 6650648.962917 318004.12550929 6650649.962917 317963.12550929 6650628.962917 317922.12550929 6650622.462917 317831.62550929 6650648.212917 317741.12550929 6650639.962917 317664.12550929 6650312.962917 317204.12550929 6650115.962917 317204.12550929 6650115.962917 317204.12550929 6650115.962917 317204.12550929 6650115.962917</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon></lipas:the_geom></lipas:lipas_kaikki_alueet></gml:featureMembers></wfs:FeatureCollection>";
	
	
	private static final String kryzStringFeatures2 = "";
	
	
	@Test
	public void testExecute() {
		
		org.geotools.xml.Configuration configuration = new org.geotools.gml3.GMLConfiguration();
		org.geotools.xml.Parser parser = new org.geotools.xml.Parser(configuration);
		
		InputStream input = new ByteArrayInputStream(xmlString2Features.getBytes(StandardCharsets.UTF_8));
		
		SimpleFeatureCollection fc = null;
		try {
			fc = (SimpleFeatureCollection) parser.parse(input);
		} catch (IOException e) {
			e.printStackTrace();
		} catch (SAXException e) {
			e.printStackTrace();
		} catch (ParserConfigurationException e) {
			e.printStackTrace();
		}
		
		SimpleFeatureCollection result = execute(
				fc,
				new java.lang.Double(100),
				null,
				true,
				false
		);
		
		SimpleFeatureCollection resultMerged = execute(
				fc,
				new java.lang.Double(100),
				null,
				true,
				true
		);
		
		String asd = "";
	}
	
	
	public SimpleFeatureCollection execute(
			SimpleFeatureCollection features,
			Double distance,
			String attributeName,
			Boolean includeOriginal,
			Boolean mergeBuffers) {
		
		if (includeOriginal == null) {
			includeOriginal = true;
		}
		
		List<SimpleFeature> ret = new ArrayList<SimpleFeature>();
		
		SimpleFeatureTypeBuilder mergedFtb = new SimpleFeatureTypeBuilder();
		Map<String, Object> mergedAttributeValues = new HashMap<String, Object>();
		Geometry mergedGeometry = null;
		
		SimpleFeatureIterator iter = features.features();
		
		while (iter.hasNext()) {
			
			SimpleFeature feature = iter.next();
			LinkedHashMap<String, AttributeDescriptor> mergedAttributeDescriptors = new LinkedHashMap<String, AttributeDescriptor>();
			SimpleFeatureTypeBuilder tb = new SimpleFeatureTypeBuilder();
			
			for (AttributeDescriptor descriptor : feature.getFeatureType().getAttributeDescriptors()) {
				//if the feature is not geometry or it is geometry but not default one, then add it as normal feature
				//otherwise change its type to MultiPolygon and save as default geometry
				//TODO check if the first condition is needed
				if (!(descriptor.getType() instanceof GeometryTypeImpl)
						|| (!feature.getFeatureType().getGeometryDescriptor().equals(descriptor))) {
					
					tb.add(descriptor);
					
					if (mergeBuffers == true) {
						mergedAttributeDescriptors.put(descriptor.getLocalName(), descriptor);
					}
					
				} else {
					AttributeTypeBuilder builder = new AttributeTypeBuilder();
					builder.setBinding(MultiPolygon.class);
					AttributeDescriptor attributeDescriptor = builder.buildDescriptor(descriptor
							.getLocalName(), builder.buildType());
					tb.add(attributeDescriptor);
					if (tb.getDefaultGeometry() == null) {
						tb.setDefaultGeometry(descriptor.getLocalName());
					}
					
					if (mergeBuffers == true) {
						mergedAttributeDescriptors.put(attributeDescriptor.getLocalName(), attributeDescriptor);
					}
				}
			}
			tb.setDescription(feature.getFeatureType().getDescription());
			tb.setCRS(feature.getFeatureType().getCoordinateReferenceSystem());
			tb.setName(feature.getFeatureType().getName());
			
			if (mergeBuffers == true) {
				mergedFtb.setDescription(feature.getFeatureType().getDescription());
				mergedFtb.setCRS(feature.getFeatureType().getCoordinateReferenceSystem());
				mergedFtb.setName(feature.getFeatureType().getName());
				//set all so far collected attributes to merged feature type
				mergedFtb.setAttributes(new ArrayList<AttributeDescriptor>(mergedAttributeDescriptors.values()));
				mergedFtb.setDefaultGeometry(tb.getDefaultGeometry());
			}
			
			
			SimpleFeatureType sft = tb.buildFeatureType();
			SimpleFeatureBuilder fb = new SimpleFeatureBuilder(sft);
			
			Geometry g = (Geometry) feature.getDefaultGeometry();
			
			Double bufferSize = distance;
			
			Iterator<AttributeDescriptor> firstIterator = feature.getFeatureType().getAttributeDescriptors()
					.iterator();
			while (firstIterator.hasNext()) {
				AttributeDescriptor ad = firstIterator.next();
				Object origAttributeValue = feature.getAttribute(ad.getLocalName());
				if (!(origAttributeValue instanceof Geometry)) {
					fb.set(ad.getLocalName(), origAttributeValue);
					
					if (mergeBuffers == true) {
						if (origAttributeValue instanceof String) {
							String attrValue = "";
							Object oldValue = mergedAttributeValues.get(ad.getLocalName());
							if (oldValue != null) {
								attrValue = oldValue.toString() + " ";
							}
							if (origAttributeValue != null) {
								attrValue += origAttributeValue.toString();
							}
							
							if (!attrValue.trim().equals("")) {
								mergedAttributeValues.put(ad.getLocalName(), attrValue.trim());
							}
						} else {
							mergedAttributeValues.put(ad.getLocalName(), origAttributeValue);
						}
					}
				}
				if (attributeName != null && ad.getLocalName().equals(attributeName)) {
					try {
						bufferSize = Double.parseDouble(feature.getAttribute(ad.getLocalName()).toString());
					} catch (NumberFormatException ex) {
						//use default value
						bufferSize = distance;
					}
				}
			}
			
			Geometry buffered = g.buffer(bufferSize);
			
			if (!includeOriginal) {
				buffered = buffered.symDifference(g);
			}
			
			if (buffered instanceof Polygon) {
				buffered = buffered.getFactory().createMultiPolygon(
						new Polygon[]{(Polygon) buffered});
			}
			
			SimpleFeature sf = fb.buildFeature(feature.getID());
			
			sf.setDefaultGeometry(buffered);
			
			if (mergeBuffers == true) {
				if (mergedGeometry == null) {
					mergedGeometry = buffered;
				} else {
					mergedGeometry = mergedGeometry.union(buffered);
				}
			}
			
			ret.add(sf);
		}
		
		if (mergeBuffers == true) {
			
			ret = new ArrayList<SimpleFeature>();
			
			SimpleFeatureType sft = mergedFtb.buildFeatureType();
			SimpleFeatureBuilder fb = new SimpleFeatureBuilder(sft);
			
			Iterator it = mergedAttributeValues.entrySet().iterator();
			while (it.hasNext()) {
				Map.Entry attributeEntry = (Map.Entry) it.next();
				fb.set(attributeEntry.getKey().toString(), attributeEntry.getValue());
			}
			
			SimpleFeature sf = fb.buildFeature(null);
			
			sf.setDefaultGeometry(mergedGeometry);
			
			ret.add(sf);
			
		}
		
		return DataUtilities.collection(ret);
	}
	
	protected SimpleFeatureType getTargetSchema(SimpleFeatureType sourceSchema) {
		SimpleFeatureTypeBuilder tb = new SimpleFeatureTypeBuilder();
		for (AttributeDescriptor ad : sourceSchema.getAttributeDescriptors()) {
			GeometryDescriptor defaultGeometry = sourceSchema.getGeometryDescriptor();
			if (ad == defaultGeometry) {
				tb.add(ad.getName().getLocalPart(), MultiPolygon.class, defaultGeometry.getCoordinateReferenceSystem());
			} else {
				tb.add(ad);
			}
		}
		tb.setName(sourceSchema.getName());
		return tb.buildFeatureType();
	}
	
	
}
